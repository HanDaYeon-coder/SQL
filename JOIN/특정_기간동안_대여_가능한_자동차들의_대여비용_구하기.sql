SELECT A.CAR_ID, A.CAR_TYPE,ROUND(A.DAILY_FEE * (100-B.discount_rate)/100, 0)*30 AS FEE
FROM CAR_RENTAL_COMPANY_CAR A
JOIN CAR_RENTAL_COMPANY_DISCOUNT_PLAN B ON A.CAR_TYPE = B.CAR_TYPE
WHERE B.DURATION_TYPE = '30일 이상' AND A.CAR_TYPE IN ('세단', 'SUV') AND
A.CAR_ID NOT IN (
    SELECT CAR_ID
    FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY
    WHERE
    (START_DATE BETWEEN '2022-11-01' AND '2022-11-30') 
     OR (END_DATE BETWEEN '2022-11-01' AND '2022-11-30')
    OR (START_DATE < '2022-11-01' AND END_DATE > '2022-11-30')
)
AND ROUND(A.DAILY_FEE * (100-B.discount_rate)/100, 0)*30 BETWEEN 500000 AND 2000000
ORDER BY FEE DESC, CAR_TYPE, CAR_ID DESC
